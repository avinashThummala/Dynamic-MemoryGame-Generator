(function(e){function it(){e.ajax({type:"GET",url:"memory.xml",dataType:"xml",success:st})}function st(i){x=e(i);t=x.find("front").text()+"?"+Math.random()*999999999;n=x.find("usebg").text()=="true"?true:false;r=x.find("bg").text()+"?"+Math.random()*999999999;s=x.find("cardW").text();o=x.find("cardH").text();columns=x.find("columns").text();a=Number(x.find("totalpairs").text());f=Number(x.find("revealspeed").text());l=Number(x.find("hidespeed").text());c=Number(x.find("fadespeed").text());h=Number(x.find("incorrecthold").text());p=Number(x.find("correcthold").text());d=Number(x.find("endscreendelay").text());v=Number(x.find("endscreenfade").text());m=x.find("showpeek").text()=="true"?true:false;g=Number(x.find("peekspeed").text());y=x.find("usetimer").text()=="true"?true:false;z=x.find("showtitle").text()=="true"?true:false;W=x.find("gametitle").text();b=x.find("showtimer").text()=="true"?true:false;w=x.find("scoresystem").text();E=x.find("displayscore").text();S=x.find("attemptscolor").text();X=x.find("skills").text().split(",");V=Number(x.find("skillInc").text());$=x.find("lineTwo").text();J=x.find("lineTwoPre").text();K=x.find("lineTwoPost").text();Q=x.find("lineTwoSolo").text();G=x.find("lineThree").text();Y=x.find("lineThreeReplay").text();Z=x.find("lineThreeLink").text();if(E=="time"||E=="both"||w=="time"){if(!y)alert("Set the 'usetimer' value in the XML to 'true'")}var u=0;x.find("card").each(function(){D.push({cardA:e(this).attr("cardA")+"?"+Math.random()*999999999,cardB:e(this).attr("cardB")+"?"+Math.random()*999999999,id:u});u++});if(a==-1){N=D.length}else{N=a}T=N*2;for(var C=0;C<N;C++){P.push(C);P.push(C+N)}if(n)I++;ft();lt(P);if(b)z=true;if(z){e(".memory").append('<div class="gametitle">'+W+"</div>");if(y)e(".gametitle").append('<div class="timer">Time Elapsed: <span id="clock"></span></div>');if(b)e("#clock").html("00:00")}if(n)e(".memory").append('<div class="bg"></div>');e(".memory").append('<div class="cards"></div>');e(".memory").append('<div class="gameover"></div>');e(".gameover").append('<div class="gameover_bg"></div>');e(".memory").css({width:s*columns,overflow:"auto",visibility:"hidden"});var k=Math.ceil(T/columns);e(".cards").css({width:s*columns,height:o*k+5+"px"});e(".gameover").css({width:s*columns});ht()}function ot(){var t=0;R=window.setInterval(function(){t+=100;U=Math.floor(t/100)/10;if(Math.round(U)==U){U+=".0"}if(b)e("#clock").html(at(U))},100)}function ut(){clearInterval(R)}function at(e){var t="",n,r;if(e>=60){n=Math.round(e/60);e=e%60;if(n<10)t+="0";t+=n+":"}else{t+="00:"}r=Math.round(e);if(r<10)t+="0";t+=r;return t}function ft(){var e=[];for(var t=0;t<D.length;t++){e.push(t)}H=[];for(t=0;t<N;t++){var n=e[Math.floor(Math.random()*e.length)];H[t]=D[n];H[t+N]=D[n];e=jQuery.grep(e,function(e){return e!=n})}}function lt(e){for(var t,n,r=e.length;r;t=parseInt(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n);return e}function ct(t,n,r){var i="."+t;e(i).click(function(){gt(n,r)})}function ht(){var u;var a;var l;I+=T;for(i=0;i<T;i++){if(P[i]<N){u=H[P[i]].id;a="a";id_set=u+a;C.push(a+u);e(".cards").append('<div class="card_holder"><div class="card" id="a'+u+'"><span class="'+id_set+'"><img class="cardFront" src="'+t+'" width="'+s+'" height="'+o+'"/></span><img class="cardBack" src="" width="'+s+'" height="'+o+'"/></div></div>');ct(id_set,u,a);l=H[P[i]].cardA;e("#"+a+u+" .cardBack").load({img:l},function(e){pt(e.data.img)}).attr("src",l)}else{u=H[P[i]].id;a="b";id_set=u+a;C.push(a+u);e(".cards").append('<div class="card_holder"><div class="card" id="b'+u+'"><span class="'+id_set+'"><img class="cardFront" src="'+t+'" width="'+s+'" height="'+o+'"/></span><img class="cardBack" src="" width="'+s+'" height="'+o+'"/></div></div>');ct(id_set,u,a);l=H[P[i]].cardB;e("#"+a+u+" .cardBack").load({img:l},function(e){pt(e.data.img)}).attr("src",l)}}if(n){if(e(".bg").children().length>0)e(".bg_img").children().remove();e(".bg").append('<div class="bg_img"><img id="bg" src=""/></div>');e("#bg").load(function(){pt(r)}).attr("src",r)}var c=f/1e3+"s";e(".card").css({"float":"left",width:s+"px",height:o+"px",position:"relative",transition:c});e(".card_holder").css({width:s+"px",height:o+"px"});e(".cardFront").css({position:"absolute",width:s+"px",height:o+"px"});e(".cardBack").css({position:"abolute",width:s+"px",height:o+"px"});if(n)e(".bg_img").css({position:"abolute"});j=e(".cards").height();F=e(".cards").width();e(".gameover").css({height:e(".cards").height()});if(z)e(".gametitle").css("width",e(".cards").width());if(nt){e(".cardFront").addClass("backVis");e(".cardBack").addClass("backVis")}else{e(".cardBack").addClass("notransform")}}function pt(e){q++;if(I==q)dt()}function dt(){e(".memory").css({visibility:"visible"});if(!Modernizr.csstransitions||!nt){if(!m){vt()}else{window.setTimeout(function(){for(var e=0;e<C.length;e++){var t="div#"+C[e]+".card";xt(t)}},1e3);window.setTimeout(function(){for(var e=0;e<C.length;e++){var t="div#"+C[e]+".card";Tt(t)}vt()},g+1e3)}}else{if(!m){vt()}else{window.setTimeout(function(){e(".card").addClass("spin")},1e3);window.setTimeout(function(){e(".card").removeClass("spin");vt()},g+1e3)}}}function vt(){_=true;if(y)ot()}function mt(t,n,r,i){e('<img src="'+t+'">').load(function(){if(I==q)dt()})}function gt(e,t){if(_){var n="div#"+t+e+".card";xt(n);if(k==null){k=e;L=n;M++}else{A=n;_=false;if(k==e){O++;window.setTimeout(function(){Nt(L);Nt(A);L=A=undefined;k=null;_=true},p);if(O==N){ut();window.setTimeout(function(){yt();O=0;M=0},d)}}else{window.setTimeout(function(){Tt(L);Tt(A);L=A=undefined;k=null;_=true},h)}}}}function yt(){if(e(".gameover_bg").children().length>0)e(".gameover_bg").children().remove();e(".gameover_bg").append("<h1>"+wt()+"</h1>");M="<span style='color:"+S+";'>"+M+"</span>";U="<span style='color:"+S+";'>"+at(U)+"</span>";var t=M;if($=="score"){if(E=="time"){K=".";t=U}else if(E=="both"){t=U+" and "+M}e(".gameover_bg").append("<p>"+J+t+K+"</p>")}else{e(".gameover_bg").append("<p>"+Q+"</p>")}if(G=="replay"){e(".gameover_bg").append('<p id="onemoretime"><a>'+Y+"</a></p>");bt()}else{e(".gameover_bg").append('<p id="onemoretime">'+Z+"</p>")}e(".gameover").fadeIn(v);var n=.5-e(".gameover_bg").height()/j/2;e(".gameover_bg").css({top:n*100+"%"})}function bt(){e("#onemoretime a").click(function(){Et()})}function wt(){for(var e=0;e<X.length;e++){if(w=="time"){if(U<=e*V)return X[e]}else{if(M<=N+e*V)return X[e]}}return X[X.length-1]}function Et(){e(".cards").children().remove();St("none");ft();lt(P);ht()}function St(t){e(".gameover").css({display:t})}function xt(t){if(!Modernizr.csstransitions||!nt){var n=e(t+" .cardFront").width()/2;e(t+" .cardBack").stop().css({width:"0px",height:""+o+"px",marginLeft:""+n+"px",opacity:"0.5"});e(t+" .cardFront").stop().animate({width:"0px",height:""+o+"px",marginLeft:""+n+"px",opacity:"0.5"},{duration:f});window.setTimeout(function(){e(t+" .cardBack").stop().animate({width:""+s+"px",height:""+o+"px",marginLeft:"0px",opacity:"1"},{duration:f})},f)}else{var r=f/1e3+"s";e(".card").css({transition:r,"-webkit-transition":r});e(t).addClass("spin");e(t).parent().css({"z-index":et});et++}}function Tt(t){if(!Modernizr.csstransitions||!nt){var n=e(t+" .cardBack").width()/2;e(t+" .cardBack").stop().animate({width:"0px",height:""+o+"px",marginLeft:""+n+"px",opacity:"0.5"},{duration:l});window.setTimeout(function(){e(t+" .cardFront").stop().animate({width:""+s+"px",height:""+o+"px",marginLeft:"0px",opacity:"1"},{duration:l})},l)}else{var r=l/1e3+"s";e(".card").css({transition:r,"-webkit-transition":r});e(t).removeClass("spin")}}function Nt(t){e(t+" .cardBack").stop().animate({opacity:"0"},{duration:c});window.setTimeout(function(){e(t+" .cardFront").stop().animate({opacity:"0"},{duration:c})},c)}var t;var n;var r;var s;var o;var u;var a;var f;var l;var c;var h;var p;var d;var v;var m;var g;var y;var b;var w;var E;var S;var x;var T;var N;var C=[];var k;var L;var A;var O=0;var M=0;var _=false;var D=[];var P=[];var H=[];var B=[];var j;var F;var I=0;var q=0;var R;var U="0.0";var z;var W;var X=[];var V;var $;var J;var K;var Q;var G;var Y;var Z;var et=1;var tt=function(){var e,t=-1;if(navigator.appName=="Microsoft Internet Explorer"){var n=navigator.userAgent;var r=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(r.exec(n)!=null)t=parseFloat(RegExp.$1)}return t>-1?t:e}();var nt=tt==undefined;var rt=navigator.platform;if(rt.indexOf("Win")!=-1){nt=false}it();})(jQuery)